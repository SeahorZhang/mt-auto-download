# 代码结构说明

## 项目结构

```
mt-auto-download/
├── api/                    # API相关模块
│   ├── config.js          # API配置（认证信息等）
│   ├── index.js           # 核心API客户端（axios配置、拦截器）
│   ├── login.js           # 登录相关API
│   ├── qbittorrent.js     # qBittorrent API客户端
│   └── search.js          # 搜索相关API
├── config/                 # 配置文件
│   └── index.js           # 主配置文件
├── lib/                   # 核心业务逻辑
│   ├── App.js            # 主应用类
│   └── DownloadManager.js # 下载管理器
├── utils/                 # 工具函数
│   ├── countdown.js       # 倒计时工具
│   ├── index.js          # 通用工具函数
│   ├── rateLimiter.js    # 请求频率控制
│   └── retry.js          # 重试机制
├── torrents/              # 种子文件存储目录
├── env.js                 # 环境变量配置
├── index.js              # 程序入口
└── package.json          # 项目配置
```

## 核心模块说明

### 1. API模块 (`api/`)

#### `api/index.js` - 核心API客户端
- **功能**: 配置axios实例，处理认证、签名、请求拦截
- **特性**: 
  - 自动添加时间戳和签名
  - 请求频率控制
  - 错误处理和重试
  - 支持FormData和JSON数据

#### `api/search.js` - 搜索API
- **功能**: 封装搜索、历史查询、种子下载API
- **特性**: 支持多种搜索类型和分类

#### `api/qbittorrent.js` - qBittorrent API
- **功能**: 原生JavaScript实现的qBittorrent Web API客户端
- **特性**: 
  - 登录认证
  - 种子上传
  - 种子列表获取
  - 自动重连

### 2. 核心业务逻辑 (`lib/`)

#### `lib/App.js` - 主应用类
- **功能**: 程序主流程控制
- **特性**:
  - 页面遍历和数据处理
  - 错误处理和重试
  - 优雅退出
  - 翻页间隔控制

#### `lib/DownloadManager.js` - 下载管理器
- **功能**: 种子下载和qBittorrent上传
- **特性**:
  - 文件大小过滤
  - 下载重试
  - 自动上传到qBittorrent
  - 资源清理

### 3. 工具模块 (`utils/`)

#### `utils/rateLimiter.js` - 请求频率控制
- **功能**: 防止API请求过于频繁
- **特性**: 滑动窗口算法，可配置限制

#### `utils/retry.js` - 重试机制
- **功能**: 指数退避重试算法
- **特性**: 智能重试，避免无效重试

#### `utils/index.js` - 通用工具
- **功能**: 文件下载、格式化、日志等
- **特性**: 完善的错误处理和超时控制

## 安全特性

### 1. 请求频率控制
- 每分钟最多8个API请求
- 自动等待和排队
- 防止被服务器限制

### 2. 错误处理
- 网络错误自动重试
- 指数退避算法
- 智能错误分类

### 3. 超时控制
- API请求30秒超时
- 文件下载60秒超时
- 防止无限等待

### 4. 资源管理
- 自动清理临时文件
- 优雅退出和资源释放
- 内存泄漏防护

## 配置说明

### 主要配置项
- `DOWNLOAD`: 下载相关配置
- `SEARCH`: 搜索相关配置
- `API`: API请求配置
- `QBITTORRENT`: qBittorrent配置
- `LOG`: 日志配置

### 安全配置
- 请求频率限制
- 重试策略
- 超时设置
- 错误处理

## 最佳实践

1. **错误处理**: 所有异步操作都有完善的错误处理
2. **资源管理**: 及时释放资源，避免内存泄漏
3. **频率控制**: 避免过于频繁的请求
4. **日志记录**: 详细的日志便于调试和监控
5. **配置化**: 所有参数都可配置，便于调整
