# 配置文件改进总结

## 概述
本文档总结了 `config/index.js` 配置文件的改进内容，包括详细的注释、说明和文档。

## 🎯 主要改进内容

### 1. **文件头部文档**
- 添加了完整的文件说明
- 包含使用方法、配置优先级等信息
- 添加了作者和版本信息

### 2. **分类清晰的配置结构**
- 🔐 API 基础配置 (8项)
- 📥 下载配置 (9项)
- 🔍 搜索配置 (5项)
- 🌐 API 配置 (7项)
- 🚀 qBittorrent 配置 (10项)
- 📝 日志配置 (3项)

### 3. **详细的配置项注释**
每个配置项都包含：
- **功能说明**：配置项的具体作用
- **数据类型**：字符串、数字、布尔值等
- **单位说明**：毫秒、字节、次数等
- **建议值**：推荐的配置范围
- **注意事项**：使用时需要注意的问题
- **获取方式**：如何获取配置值（针对认证相关配置）

### 4. **环境变量验证增强**
- 更友好的警告信息
- 包含问题说明和解决方案
- 使用表情符号提高可读性

### 5. **配置对象文档**
- 每个配置分类都有详细说明
- 保持向后兼容性
- 提供使用示例

## 📋 配置项详细说明

### 🔐 API 基础配置
| 配置项 | 说明 | 是否必需 | 获取方式 |
|--------|------|----------|----------|
| `API_BASE_URL` | M-Team API 基础 URL | 否 | 通常使用默认值 |
| `SECRET_KEY` | 签名密钥 | 否 | 通常使用默认值 |
| `AUTH_TOKEN` | 认证令牌 | **是** | 浏览器开发者工具 |
| `DID` | 设备 ID | **是** | 请求头中获取 |
| `COOKIE` | Cookie 信息 | **是** | 浏览器开发者工具 |
| `VERSION` | 客户端版本号 | 否 | 通常使用默认值 |
| `WEB_VERSION` | Web 版本号 | 否 | 通常使用默认值 |
| `VISITOR_ID` | 访问者 ID | **是** | 请求头中获取 |

### 📥 下载配置
| 配置项 | 说明 | 单位 | 建议值 |
|--------|------|------|--------|
| `DOWNLOAD_DIR` | 种子保存目录 | 路径 | `torrents` |
| `DOWNLOAD_INTERVAL` | 下载间隔 | 毫秒 | 30000-60000 |
| `DOWNLOAD_GRACEFUL_INTERVAL` | 优雅退出间隔 | 毫秒 | 10000-30000 |
| `DOWNLOAD_MAX_SIZE` | 最大文件大小 | 字节 | 150MB |
| `DOWNLOAD_MIN_SIZE` | 最小文件大小 | 字节 | 11MB |
| `DOWNLOAD_RETRY_COUNT` | 重试次数 | 次 | 3-5 |
| `DOWNLOAD_RETRY_DELAY` | 重试延迟 | 毫秒 | 5000-10000 |
| `DOWNLOAD_TIMEOUT` | 下载超时 | 毫秒 | 30000-60000 |
| `DOWNLOAD_MAX_CONCURRENT` | 最大并发数 | 个 | 1-3 |

### 🔍 搜索配置
| 配置项 | 说明 | 单位 | 建议值 |
|--------|------|------|--------|
| `SEARCH_PAGE_SIZE` | 每页数量 | 个 | 50-100 |
| `SEARCH_START_PAGE` | 起始页码 | 页 | 1 |
| `SEARCH_MAX_ERRORS_PER_PAGE` | 每页最大错误数 | 次 | 3-5 |
| `SEARCH_PAGE_INTERVAL` | 翻页间隔 | 毫秒 | 5000-10000 |
| `SEARCH_MAX_PAGES_PER_SESSION` | 每次会话最大页数 | 页 | 50-100 |

### 🌐 API 配置
| 配置项 | 说明 | 单位 | 建议值 |
|--------|------|------|--------|
| `API_MAX_REQUESTS` | 每分钟最大请求数 | 次/分钟 | 5-10 |
| `API_TIME_WINDOW` | 时间窗口 | 毫秒 | 60000 |
| `API_MAX_RETRIES` | 最大重试次数 | 次 | 3-5 |
| `API_BASE_DELAY` | 基础延迟时间 | 毫秒 | 2000-5000 |
| `API_MAX_DELAY` | 最大延迟时间 | 毫秒 | 10000-30000 |
| `API_TIMEOUT` | 请求超时 | 毫秒 | 30000-60000 |

### 🚀 qBittorrent 配置
| 配置项 | 说明 | 类型 | 说明 |
|--------|------|------|------|
| `QB_ENABLED` | 是否启用 | 布尔值 | true/false |
| `QB_BASE_URL` | Web UI 地址 | URL | http://IP:端口 |
| `QB_USERNAME` | 用户名 | 字符串 | 登录用户名 |
| `QB_PASSWORD` | 密码 | 字符串 | 登录密码 |
| `QB_DOWNLOAD_PATH` | 临时下载路径 | 路径 | 临时目录 |
| `QB_FINAL_PATH` | 最终保存路径 | 路径 | 最终目录 |
| `QB_CATEGORY` | 种子分类 | 字符串 | 分类名称 |
| `QB_TAGS` | 种子标签 | 字符串 | 逗号分隔 |
| `QB_USE_CATEGORY` | 是否传递分类 | 布尔值 | true/false |
| `QB_TIMEOUT` | 连接超时 | 毫秒 | 10000-30000 |

### 📝 日志配置
| 配置项 | 说明 | 类型 | 可选值 |
|--------|------|------|--------|
| `LOG_SAVE_TO_FILE` | 是否保存到文件 | 布尔值 | true/false |
| `LOG_DIR` | 日志目录 | 路径 | 目录路径 |
| `LOG_LEVEL` | 日志级别 | 字符串 | debug/info/warn/error |

## 🚀 使用建议

### 1. **首次配置**
1. 复制 `.env.example` 为 `.env`
2. 设置必需的认证信息
3. 根据需要调整其他配置项
4. 使用 `pnpm validate` 验证配置

### 2. **配置调优**
- **下载频率**：根据网络状况调整间隔时间
- **请求限制**：避免被服务器限制访问
- **超时设置**：根据网络稳定性调整
- **日志级别**：生产环境使用 info，调试时使用 debug

### 3. **安全注意事项**
- 不要将 `.env` 文件提交到版本控制
- 定期更新认证信息
- 使用强密码保护 qBittorrent
- 定期检查访问日志

## 📚 相关文档

- [环境变量设置指南](ENV_SETUP.md) - 详细的环境变量配置说明
- [配置映射说明](CONFIG_MAPPING.md) - 环境变量与配置项的对应关系
- [代码结构说明](CODE_STRUCTURE.md) - 项目代码结构分析

## 🔄 版本历史

- **v1.1.4** - 完善配置文件注释和文档
- **v1.1.3** - 添加环境变量支持
- **v1.1.2** - 重构配置结构
- **v1.1.1** - 基础配置功能
- **v1.1.0** - 初始版本

## 🤝 贡献指南

如果您发现配置说明有误或需要补充，欢迎：
1. 提交 Issue 描述问题
2. 提交 Pull Request 修复问题
3. 在讨论区分享使用经验

---

*最后更新：2024年12月*
